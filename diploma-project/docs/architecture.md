# Архитектура системы "Процент профессионализма"

## Обзор

Система состоит из трех основных компонентов:

1. **Web Service** (Go + Gin) - веб-интерфейс и API
2. **ML Service** (Python + FastAPI) - сервис машинного обучения
3. **Database** (SQLite) - хранение результатов тестирования

## Архитектурная диаграмма

```
┌─────────────┐
│   Browser   │
└──────┬──────┘
       │ HTTP
       ▼
┌─────────────────────────────────────────┐
│         Web Service (Go/Gin)            │
│  ┌────────────────────────────────────┐ │
│  │  HTTP Server (port 8080)           │ │
│  │  - Route handlers                  │ │
│  │  - Request validation              │ │
│  │  - CORS middleware                 │ │
│  └────────────────────────────────────┘ │
└───────┬──────────────────┬──────────────┘
        │                  │
        │ HTTP             │ SQLite
        ▼                  ▼
┌──────────────────┐  ┌────────────┐
│   ML Service     │  │  Database  │
│  (Python/FastAPI)│  │  (SQLite)  │
│                  │  │            │
│  ┌────────────┐  │  │  Results   │
│  │   Model    │  │  │  Storage   │
│  │ (sklearn)  │  │  │            │
│  └────────────┘  │  └────────────┘
└──────────────────┘
```

## Компоненты системы

### 1. Web Service (Go)

**Технологии:**
- Go 1.21
- Gin Web Framework
- SQLite3 driver

**Основные функции:**
- Обслуживание HTML интерфейса
- Валидация входных данных (20 вопросов, значения 1-5)
- Проксирование запросов к ML сервису
- Сохранение результатов в базу данных
- Предоставление API для получения результатов

**Endpoints:**
- `GET /` - главная страница
- `POST /api/predict` - получение предсказаний
- `POST /api/submit` - сохранение результатов
- `GET /api/results/:id` - просмотр результатов
- `GET /health` - health check

### 2. ML Service (Python)

**Технологии:**
- Python 3.10
- FastAPI
- scikit-learn
- pandas, numpy

**Основные функции:**
- Загрузка обученной модели
- Обработка запросов на предсказание
- Возврат вероятностей для 27 специальностей
- Health check endpoint

**Endpoints:**
- `POST /predict` - предсказание специальностей
- `GET /health` - проверка работоспособности
- `GET /specialties` - список специальностей

**Модель:**
- Алгоритм: Random Forest Classifier
- Входные данные: 20 числовых признаков (q1-q20)
- Выходные данные: вероятности для 27 классов
- Формат хранения: joblib pickle

### 3. Database (SQLite)

**Таблица: survey_results**

| Поле | Тип | Описание |
|------|-----|----------|
| id | INTEGER PRIMARY KEY | Уникальный идентификатор |
| name | TEXT NOT NULL | Имя пользователя |
| email | TEXT | Email (опционально) |
| answers | TEXT NOT NULL | JSON с ответами |
| predictions | TEXT NOT NULL | JSON с результатами |
| created_at | TIMESTAMP | Время создания |

## Поток данных

### Процесс прохождения теста:

1. Пользователь заполняет Яндекс.Форму (iframe)
2. Пользователь вводит ответы в форму на сайте
3. Web Service валидирует данные
4. Web Service отправляет запрос к ML Service
5. ML Service загружает модель и делает предсказание
6. ML Service возвращает вероятности специальностей
7. Web Service сохраняет результаты в SQLite
8. Web Service отображает топ-5 специальностей

### Формат запроса к ML Service:

```json
{
  "q1": 5,
  "q2": 3,
  ...
  "q20": 4
}
```

### Формат ответа от ML Service:

```json
{
  "predictions": {
    "Реклама": 87.5,
    "Программирование": 92.3,
    ...
  },
  "top_5": [
    {
      "speciality": "Программирование",
      "percentage": 92.3,
      "rank": 1
    },
    ...
  ]
}
```

## Масштабируемость

### Горизонтальное масштабирование:

- **Web Service**: можно запустить несколько экземпляров за load balancer
- **ML Service**: stateless, легко масштабируется
- **Database**: для production рекомендуется PostgreSQL/MySQL

### Вертикальное масштабирование:

- ML Service требует больше CPU для инференса
- Web Service требует больше памяти при высоких нагрузках

## Безопасность

### Реализованные меры:

1. **Валидация данных**: проверка всех входных параметров
2. **CORS**: настроенные правила для cross-origin запросов
3. **Rate limiting**: рекомендуется добавить для production
4. **HTTPS**: рекомендуется для production

### Рекомендации для production:

1. Использовать HTTPS/TLS
2. Добавить аутентификацию/авторизацию
3. Реализовать rate limiting
4. Логирование и мониторинг
5. Защита от SQL injection (подготовленные запросы)

## Мониторинг и логирование

### Health checks:

- Web Service: `/health`
- ML Service: `/health`

### Метрики для мониторинга:

- Время ответа API
- Использование памяти
- CPU utilization
- Количество запросов в секунду
- Ошибки предсказаний

## DevOps

### Docker:

- Два контейнера: web-service, ml-service
- Shared volume для данных и модели
- Docker Compose для локальной разработки

### CI/CD:

- GitHub Actions для автоматической сборки
- Тесты перед деплоем
- Автоматический push в Docker Hub

## Производительность

### Ожидаемые показатели:

- Время предсказания: < 100ms
- Пропускная способность: > 100 RPS
- Размер модели: ~500KB

### Оптимизации:

- Кэширование модели в памяти
- Использование prepared statements для БД
- Асинхронная обработка запросов в FastAPI
